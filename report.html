<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <title>é©¬å¹´å¼€è¿ Â· ç©¿æ­æŠ¥å‘Š</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        /* ç°ä»£åŒ–å­—ä½“å¼•å…¥ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700&display=swap');

        body {
            background: linear-gradient(145deg, #f9f0e9 0%, #f2e3d8 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 12px;
        }

        .app-container {
            max-width: 420px;
            width: 100%;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 40px;
            box-shadow: 
                0 20px 40px rgba(140, 100, 70, 0.15),
                0 8px 20px rgba(0, 0, 0, 0.05),
                inset 0 0 0 1px rgba(255, 255, 255, 0.8);
            padding: 24px 20px;
            position: relative;
            border: 1px solid rgba(255, 245, 235, 0.6);
        }

        /* è£…é¥°æ€§èƒŒæ™¯å…ƒç´  */
        .app-container::before {
            content: "";
            position: absolute;
            top: -10px;
            right: -10px;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(248, 168, 156, 0.15) 0%, transparent 70%);
            border-radius: 50%;
            z-index: 0;
            pointer-events: none;
        }

        .app-container::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: -10px;
            width: 180px;
            height: 180px;
            background: radial-gradient(circle, rgba(199, 224, 176, 0.15) 0%, transparent 70%);
            border-radius: 50%;
            z-index: 0;
            pointer-events: none;
        }

        /* é¡µé¢åˆ‡æ¢ */
        .page {
            display: none;
            position: relative;
            z-index: 2;
        }
        .page.active {
            display: block;
            animation: fadeIn 0.4s cubic-bezier(0.2, 0.9, 0.3, 1);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* å¤´éƒ¨ - é©¬å¹´çº¢ç«ï¼Œæ ‡é¢˜åŠ ç²— */
        .header {
            text-align: center;
            margin-bottom: 28px;
            position: relative;
        }

        .title {
            font-size: 1.9rem;
            font-weight: 700;
            background: linear-gradient(135deg, #c44f4f 0%, #e07a5f 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 2px;
            margin-bottom: 6px;
            text-shadow: 0 2px 10px rgba(196, 79, 79, 0.2);
        }

        .subtitle {
            color: #b48c7c;
            font-size: 0.9rem;
            font-weight: 500;
            letter-spacing: 1px;
            position: relative;
            display: inline-block;
            padding: 0 20px;
        }

        .subtitle::before,
        .subtitle::after {
            content: "â€¢";
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: #f0a28c;
            font-size: 1.2rem;
            opacity: 0.6;
        }

        .subtitle::before {
            left: 0;
        }

        .subtitle::after {
            right: 0;
        }
        
        /* å››æŸ±å¡ç‰‡ */
        .sizhu-row {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .zhu-item {
            background: white;
            padding: 12px 8px;
            border-radius: 20px;
            min-width: 85px;
            box-shadow: 0 12px 24px -12px rgba(140, 100, 70, 0.2);
            border: 1px solid rgba(240, 220, 200, 0.6);
            backdrop-filter: blur(5px);
            transition: all 0.2s;
        }

        .zhu-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 18px 30px -12px rgba(196, 79, 79, 0.25);
        }

        .zhu-label {
            color: #b99f8b;
            font-size: 0.7rem;
            font-weight: 500;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .zhu-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: #8a6f5c;
            letter-spacing: 2px;
        }
        
        /* å–œå¿Œè§£è¯» - æ¯›ç»ç’ƒå¡ç‰‡ */
        .xi-ji-box {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 28px;
            padding: 18px;
            margin-top: 16px;
            border: 1px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 12px 24px -12px rgba(140, 100, 70, 0.15);
        }

        .xi-title, .ji-title {
            font-size: 1rem;
            color: #c44f4f;
            margin-bottom: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .xi-title::before {
            content: "âœ¨";
            font-size: 1.1rem;
        }

        .ji-title::before {
            content: "âš ï¸";
            font-size: 1.1rem;
        }

        .xi-content, .ji-content {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            margin-bottom: 14px;
        }

        .wuxing-badge {
            background: white;
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #6f5e52;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 1px solid rgba(240, 210, 190, 0.5);
            box-shadow: 0 4px 12px rgba(0,0,0,0.02);
            font-weight: 500;
        }

        .color-chip {
            width: 20px;
            height: 20px;
            border-radius: 6px;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: inline-block;
        }

        /* é¢œè‰²å®šä¹‰ - é©¬å¡é¾™è‰²ç³» */
        .color-chip[data-wuxing="æœ¨"],
        .color-dot-large[data-wuxing="æœ¨"] { background: #c7e0b0; }
        .color-chip[data-wuxing="ç«"],
        .color-dot-large[data-wuxing="ç«"] { background: #f8a89c; }
        .color-chip[data-wuxing="åœŸ"],
        .color-dot-large[data-wuxing="åœŸ"] { background: #f5d7b3; }
        .color-chip[data-wuxing="é‡‘"],
        .color-dot-large[data-wuxing="é‡‘"] { background: #f0e5da; }
        .color-chip[data-wuxing="æ°´"],
        .color-dot-large[data-wuxing="æ°´"] { background: #b7d9d9; }

        .xi-desc {
            font-size: 0.9rem;
            color: #8f7663;
            line-height: 1.6;
            background: rgba(250, 240, 235, 0.4);
            padding: 14px;
            border-radius: 20px;
            font-weight: 400;
        }
        
        /* æ¯æ—¥å¡ç‰‡ - ç°ä»£åŒ–å¡ç‰‡è®¾è®¡ */
        .daily-card {
            background: white;
            border-radius: 32px;
            overflow: hidden;
            box-shadow: 0 20px 35px -10px rgba(140, 100, 70, 0.2);
            margin-bottom: 24px;
            border: 1px solid rgba(240, 220, 200, 0.5);
        }

        .card-header {
            background: linear-gradient(145deg, #fcf5f0, #f8eee8);
            padding: 18px 20px;
            border-bottom: 2px solid rgba(226, 211, 200, 0.5);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .date-section {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .date-badge {
            font-size: 1.2rem;
            color: #8a6f5c;
            font-weight: 600;
        }

        .weekday-badge {
            font-size: 0.85rem;
            color: #c2a38b;
            font-weight: 500;
        }

        .ganzhi-badge {
            background: white;
            border-radius: 20px;
            padding: 6px 16px;
            font-size: 1.2rem;
            color: #8a6f5c;
            font-weight: 600;
            border: 1px solid rgba(232, 211, 190, 0.6);
            box-shadow: 0 4px 12px rgba(0,0,0,0.02);
        }

        .relation-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(5px);
            border-radius: 20px;
            padding: 4px 14px;
            font-size: 0.75rem;
            color: #b48c7c;
            border: 1px solid rgba(240, 210, 190, 0.5);
            margin-top: 6px;
            font-weight: 500;
        }
        
        .card-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        
        /* é¢œè‰²åŒºåŸŸ - ç°ä»£åŒ–å±•ç¤º */
        .color-section {
            background: linear-gradient(145deg, #fcf5f0, #f8eee8);
            border-radius: 20px;
            padding: 14px 18px;
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        .color-dots {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-dot-large {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            border: 3px solid white;
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
        }

        .color-names {
            font-size: 1rem;
            color: #8a6f5c;
            font-weight: 600;
        }

        .avoid-tag {
            font-size: 0.8rem;
            color: #b1866b;
            background: rgba(255, 240, 235, 0.7);
            backdrop-filter: blur(5px);
            padding: 6px 16px;
            border-radius: 20px;
            margin-left: auto;
            font-weight: 500;
            border: 1px solid rgba(240, 200, 180, 0.3);
        }
        
        /* å…¬å¼åŒº - ç°ä»£åŒ–å¡ç‰‡ */
        .formula-section, .analysis-section, .outfit-section, .accessory-section {
            background: rgba(250, 240, 235, 0.4);
            backdrop-filter: blur(8px);
            border-radius: 24px;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.7);
        }

        .formula-title, .analysis-title, .outfit-title, .accessory-title {
            font-size: 0.8rem;
            color: #b99f8b;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .formula-text {
            font-size: 0.95rem;
            color: #8a6f5c;
            background: white;
            padding: 12px 16px;
            border-radius: 20px;
            border: 1px solid rgba(240, 220, 200, 0.5);
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.02);
        }

        .analysis-text {
            font-size: 0.9rem;
            color: #7a695d;
            line-height: 1.7;
            font-weight: 400;
            padding: 0 4px;
        }

        .outfit-text, .accessory-text {
            font-size: 1rem;
            color: #8a6f5c;
            background: white;
            padding: 12px 18px;
            border-radius: 20px;
            border: 1px solid rgba(240, 220, 200, 0.5);
            text-align: center;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.02);
        }
        
        /* ä¸€å‘¨ç©¿æ­æ¦‚è§ˆé¡µ - ç°ä»£åŒ–å¡ç‰‡ */
        .week-preview {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 32px;
            padding: 24px 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 20px 35px -10px rgba(140, 100, 70, 0.2);
        }

        .week-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #c44f4f 0%, #e07a5f 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }

        .date-range-badge {
            background: white;
            padding: 14px;
            border-radius: 20px;
            color: #8a6f5c;
            font-size: 1rem;
            margin-bottom: 24px;
            border: 1px solid rgba(240, 220, 200, 0.5);
            font-weight: 500;
            box-shadow: 0 8px 20px rgba(0,0,0,0.03);
        }

        .day-circles {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 24px 0;
            flex-wrap: wrap;
        }

        .day-circle {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            background: white;
            border: 2px solid rgba(248, 168, 156, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #b48c7c;
            font-size: 0.8rem;
            transition: all 0.2s ease;
            cursor: pointer;
            font-weight: 500;
            box-shadow: 0 8px 20px rgba(0,0,0,0.05);
        }

        .day-circle:hover {
            border-color: #c44f4f;
            color: #c44f4f;
            transform: scale(1.05);
            box-shadow: 0 12px 25px -8px rgba(196, 79, 79, 0.3);
        }

        .day-circle span {
            font-size: 1.3rem;
            font-weight: 700;
            color: #c44f4f;
        }
        
        /* ç¿»é¡µæŒ‰é’®ç»„ */
        .page-buttons {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            margin: 24px 0;
        }

        .page-btn {
            background: white;
            color: #7e6b5c;
            border: 1px solid rgba(240, 220, 200, 0.5);
            padding: 14px 18px;
            border-radius: 20px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            backdrop-filter: blur(5px);
        }

        .page-btn:hover:not(:disabled) {
            background: #fcf5f0;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -8px rgba(140, 100, 70, 0.2);
        }

        .page-btn.primary {
            background: linear-gradient(135deg, #c44f4f 0%, #e07a5f 100%);
            color: white;
            border: none;
            box-shadow: 0 10px 20px -5px rgba(196, 79, 79, 0.3);
        }

        .page-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            background: rgba(240, 230, 220, 0.5);
        }
        
        /* å¯¼èˆªç‚¹ */
        .nav-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 24px 0 8px;
            flex-wrap: wrap;
            padding: 0 10px;
        }

        .nav-dot {
            width: 8px;
            height: 8px;
            border-radius: 4px;
            background: rgba(200, 170, 150, 0.3);
            border: none;
            padding: 0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-dot:hover {
            background: rgba(196, 79, 79, 0.5);
        }

        .nav-dot.active {
            background: #c44f4f;
            width: 24px;
            box-shadow: 0 0 12px rgba(196, 79, 79, 0.4);
        }
        
        .footer {
            text-align: center;
            color: #c9b5a8;
            font-size: 0.7rem;
            margin-top: 20px;
            font-weight: 400;
            letter-spacing: 0.5px;
        }
        
        /* æ‰‹æœºç«¯ä¼˜åŒ– */
        @media (max-width: 400px) {
            .app-container { 
                padding: 20px 16px; 
            }

            .title {
                font-size: 1.6rem;
            }

            .day-circle { 
                width: 50px; 
                height: 50px; 
            }

            .day-circle span {
                font-size: 1.1rem;
            }

            .page-buttons {
                flex-direction: column;
            }

            .color-section {
                flex-direction: column;
                align-items: flex-start;
            }

            .avoid-tag { 
                margin-left: 0; 
            }
        }

        /* è¶…å°å±ä¼˜åŒ– */
        @media (max-width: 340px) {
            .zhu-item {
                min-width: 70px;
                padding: 10px 4px;
            }

            .zhu-value {
                font-size: 1.2rem;
            }

            .day-circle {
                width: 45px;
                height: 45px;
            }
        }
    </style>
</head>
<body>
<div class="app-container">
    <!-- é¡µé¢3ï¼šå…«å­—å–œå¿Œæ¡£æ¡ˆ -->
    <div id="page3" class="page active">
        <div class="header">
            <div class="title">å…«å­—å–œå¿Œæ¡£æ¡ˆ</div>
            <div class="subtitle" id="birthFullDate"></div>
        </div>
        
        <!-- å››æŸ± -->
        <div class="sizhu-row" id="sizhuDisplay" style="justify-content: center;">
            <!-- åŠ¨æ€å¡«å…… -->
        </div>
        
        <!-- å–œç”¨è§£è¯» -->
        <div class="xi-ji-box">
            <div class="xi-title">å–œç”¨äº”è¡Œ Â· åŸºç¡€è‰²ç³»</div>
            <div class="xi-content" id="xiDisplay"></div>
            <div class="xi-desc" id="xiDesc"></div>
        </div>
        
        <!-- å¿Œç”¨è§£è¯» -->
        <div class="xi-ji-box">
            <div class="ji-title">æ…ç”¨äº”è¡Œ Â· é¿å…è‰²ç³»</div>
            <div class="ji-content" id="jiDisplay"></div>
        </div>
        
        <!-- å…¨å¹´ç©¿æ­å®šæµ·ç¥é’ˆ -->
        <div class="analysis-section" style="margin-top: 16px;">
            <div class="analysis-title">é©¬å¹´å¼€è¿åŸºè°ƒ</div>
            <div class="analysis-text" id="yearBase"></div>
        </div>
        
        <!-- æŸ¥çœ‹ä¸€å‘¨ç©¿æ­æŒ‰é’® -->
        <button class="btn" onclick="goToPage(4)" style="margin-top: 20px;">æŸ¥çœ‹ä¸€å‘¨ç©¿æ­ â†’</button>
        
        <div class="nav-dots">
            <button class="nav-dot" onclick="goToPage(3)"></button>
            <button class="nav-dot" onclick="goToPage(4)"></button>
            <button class="nav-dot" onclick="goToPage(5)"></button>
            <button class="nav-dot" onclick="goToPage(6)"></button>
            <button class="nav-dot" onclick="goToPage(7)"></button>
            <button class="nav-dot" onclick="goToPage(8)"></button>
            <button class="nav-dot" onclick="goToPage(9)"></button>
            <button class="nav-dot" onclick="goToPage(10)"></button>
            <button class="nav-dot" onclick="goToPage(11)"></button>
        </div>
    </div>
    
    <!-- é¡µé¢4ï¼šä¸€å‘¨ç©¿æ­æ¦‚è§ˆé¡µ -->
    <div id="page4" class="page">
        <div class="header">
            <div class="title">ä¸€å‘¨ç©¿æ­æ¦‚è§ˆ</div>
            <div class="subtitle" id="weekRange"></div>
        </div>
        
        <div class="week-preview">
            <div class="week-title">ğŸ“… æœªæ¥ä¸ƒå¤©</div>
            <div class="date-range-badge" id="weekDates"></div>
            
            <div class="day-circles" id="dayCircles">
                <!-- åŠ¨æ€ç”Ÿæˆ7ä¸ªåœ†åœˆ -->
            </div>
            
            <p style="color: #8f7663; margin: 20px 0; font-weight: 400;">ç‚¹å‡»æ—¥æœŸæŸ¥çœ‹æ¯æ—¥ç©¿æ­</p>
            
            <button class="btn" onclick="goToPage(5)">å¼€å§‹æŸ¥çœ‹ç¬¬ä¸€å¤© â†’</button>
        </div>
        
        <div class="nav-dots">
            <button class="nav-dot" onclick="goToPage(3)"></button>
            <button class="nav-dot active" onclick="goToPage(4)"></button>
            <button class="nav-dot" onclick="goToPage(5)"></button>
            <button class="nav-dot" onclick="goToPage(6)"></button>
            <button class="nav-dot" onclick="goToPage(7)"></button>
            <button class="nav-dot" onclick="goToPage(8)"></button>
            <button class="nav-dot" onclick="goToPage(9)"></button>
            <button class="nav-dot" onclick="goToPage(10)"></button>
            <button class="nav-dot" onclick="goToPage(11)"></button>
        </div>
    </div>
    
    <!-- é¡µé¢5-11ï¼šæ¯æ—¥ç©¿æ­æ¨èï¼ˆ7å¤©ï¼‰ -->
    <div id="page5" class="page"></div>
    <div id="page6" class="page"></div>
    <div id="page7" class="page"></div>
    <div id="page8" class="page"></div>
    <div id="page9" class="page"></div>
    <div id="page10" class="page"></div>
    <div id="page11" class="page"></div>

    <div class="footer">
        âœ¨ ç‚¹å‡»ä¸‹æ–¹åœ†ç‚¹åˆ‡æ¢é¡µé¢
    </div>
</div>

<script>
    // ---------- åŸºç¡€æ•°æ® ----------
    const TIAN_GAN = ["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"];
    const DI_ZHI_MONTH = ["å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥","å­","ä¸‘"];
    const DI_ZHI_OTHER = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
    
    const GAN_WUXING = {
        "ç”²":"æœ¨","ä¹™":"æœ¨","ä¸™":"ç«","ä¸":"ç«","æˆŠ":"åœŸ","å·±":"åœŸ",
        "åºš":"é‡‘","è¾›":"é‡‘","å£¬":"æ°´","ç™¸":"æ°´"
    };
    
    const WUXING_COLOR_NAME = {
        "æœ¨": "ç»¿è‰²",
        "ç«": "çº¢è‰²",
        "åœŸ": "é»„è‰²/æ£•è‰²",
        "é‡‘": "ç™½è‰²/é“¶è‰²",
        "æ°´": "é»‘è‰²/è“è‰²"
    };
    
    // äº”è¡ŒåŸºç¡€è§£è¯»
    const XI_DESC = {
        "æœ¨": "åŸºç¡€è‰²ç³»ä¸ºé’ã€ç»¿ã€ç¢§è‰²ï¼ˆæ–°ä¸­å¼è‰æœ¨ç»¿ã€ç«¹é’æœ€å®œï¼‰ï¼Œä¸»ç”Ÿæœºã€äº‹ä¸šæ‹“å±•ã€‚å…¨å¹´ç©¿æ­ä»¥ç»¿è‰²ç³»ä¸ºåŸºè°ƒï¼Œå¯å¤§èƒ†è¿ç”¨è‰æœ¨ç»¿ã€ç«¹é’ã€è±†ç»¿ç­‰ï¼Œæ­é…ç±³è‰²ã€ç™½è‰²å¢å¼ºå±‚æ¬¡æ„Ÿã€‚",
        "ç«": "åŸºç¡€è‰²ç³»ä¸ºçº¢ã€æ©™ã€ç´«ï¼ˆä¸™åˆé©¬å¹´æœ¬å‘½ç«ï¼Œæ©™çº¢æ›´æ˜¾æ´»åŠ›ï¼‰ï¼Œä¸»çƒ­æƒ…ã€è´¢è¿äº¨é€šã€‚å…¨å¹´ç©¿æ­ä»¥çº¢è‰²ç³»ä¸ºåŸºè°ƒï¼Œå¯è¿ç”¨ç –çº¢ã€çŠç‘šç²‰ã€é…’çº¢ç­‰ï¼Œæ­é…é‡‘è‰²é¥°å“å¢å¼ºè´¢è¿ã€‚",
        "åœŸ": "åŸºç¡€è‰²ç³»ä¸ºç±³ã€å’–ã€é©¼è‰²ï¼ˆå¤§åœ°è‰²ç³»æœ€ç™¾æ­ï¼‰ï¼Œä¸»ç¨³é‡ã€äººç¼˜å’Œè°ã€‚å…¨å¹´ç©¿æ­ä»¥å¤§åœ°è‰²ç³»ä¸ºåŸºè°ƒï¼Œå¯è¿ç”¨ç‡•éº¦è‰²ã€å¡å…¶ã€é©¼è‰²ç­‰ï¼Œæ­é…æœ¨è´¨é…é¥°å¢å¼ºäººç¼˜ã€‚",
        "é‡‘": "åŸºç¡€è‰²ç³»ä¸ºç™½ã€é“¶ã€é‡‘è‰²ï¼ˆæ¸…å†·ç´ é›…ï¼Œæ˜¾è´¨æ„Ÿï¼‰ï¼Œä¸»è´µæ°”ã€è´¢è¿èšæ‹¢ã€‚å…¨å¹´ç©¿æ­ä»¥ç™½è‰²ç³»ä¸ºåŸºè°ƒï¼Œå¯è¿ç”¨ç±³ç™½ã€é“¶ç°ã€çç ç™½ç­‰ï¼Œæ­é…é‡‘å±é…é¥°å¢å¼ºè´µæ°”ã€‚",
        "æ°´": "åŸºç¡€è‰²ç³»ä¸ºè“ã€é»‘ã€è—é’ï¼ˆæ·±é‚æ²‰é™ï¼Œæ˜¾æ ¼è°ƒï¼‰ï¼Œä¸»æ™ºæ…§ã€äººè„‰å¹¿é˜”ã€‚å…¨å¹´ç©¿æ­ä»¥è“è‰²ç³»ä¸ºåŸºè°ƒï¼Œå¯è¿ç”¨é›¾éœ¾è“ã€è—é’ã€æ·±æµ·è“ç­‰ï¼Œæ­é…é“¶é¥°å¢å¼ºæ™ºæ…§ã€‚"
    };
    
    // é…é¥°åº“
    const ACCESSORY_LIBRARY = {
        "æœ¨": ["é’ç‰çŸ³ä¸²ç ", "æœ¨è´¨æ‰‹ä¸²", "ç¥–æ¯ç»¿åŠå ", "ç«¹èŠ‚é“¶é¥°", "æ©„æ¦„çŸ³è€³é¥°"],
        "ç«": ["çº¢ç›ç‘™ä¸²ç ", "çŠç‘šåŠå ", "çŸ³æ¦´çŸ³æ‰‹é“¾", "é‡‘è‰²æµè‹è€³é¥°", "çº¢çº¹çŸ³æˆ’æŒ‡"],
        "åœŸ": ["èœœèœ¡åŠå ", "æª€æœ¨æ‰‹ä¸²", "ç¥ç€è€³é¥°", "é™¶åœŸç é¡¹é“¾", "é»„æ°´æ™¶æˆ’æŒ‡"],
        "é‡‘": ["é“¶è´¨é”éª¨é“¾", "çç è€³é¥°", "ç™½é‡‘æˆ’æŒ‡", "æœˆå…‰çŸ³æ‰‹é“¾", "é’›é’¢é¡¹é“¾"],
        "æ°´": ["è“æ™¶çŸ³æ‰‹ä¸²", "æµ·è“å®åŠå ", "é»‘æ›œçŸ³æˆ’æŒ‡", "é“¶è´¨æµè‹", "é’é‡‘çŸ³è€³é¥°"]
    };
    
    // ç©¿æ­å•å“åº“
    const OUTFIT_LIBRARY = {
        "æœ¨": ["æ£‰éº»è¡¬è¡« + é˜”è…¿è£¤", "é’ˆç»‡å¼€è¡« + ç™½è‰²åŠè£™", "è¿è¡£è£™ + è‰ç¼–åŒ…", "ä¸ç»’å¤–å¥— + ç±³è‰²å†…æ­", "å·¥è£…è£¤ + ç™½Tæ¤", "é’ˆç»‡è¡« + å¡å…¶è‰²é•¿è£¤", "è¥¿è£…å¥—è£…"],
        "ç«": ["çœŸä¸è¡¬è¡« + ç™½è‰²è¥¿è£¤", "å«è¡£ + ç‰›ä»”åŠè£™", "é’ˆç»‡å¼€è¡« + ç¢èŠ±è£™", "ä¸ç»’è£™ + æµ…è‰²å¤–å¥—", "æ¯›è¡£ + ç°è‰²é˜”è…¿è£¤", "ç¼é¢åŠè£™ + ç±³è‰²é’ˆç»‡", "è¥¿è£…å¥—è£…"],
        "åœŸ": ["é£è¡£ + ç™½è‰²å†…æ­", "å·¥è£…è£¤ + æ¡çº¹è¡«", "é’ˆç»‡è£™ + æ£•è‰²è…°å¸¦", "å¤§è¡£ + ç±³è‰²æ¯›è¡£", "è¥¿è£…å¥—è£… + è¿åŠ¨é‹", "åŠè£™ + å¥¶æ²¹ç™½ä¸Šè¡£", "æ£‰éº»å¥—è£…"],
        "é‡‘": ["é’ˆç»‡è¡« + æµ…è“ç‰›ä»”è£¤", "ç¼é¢è¡¬è¡« + é»‘è‰²è¥¿è£¤", "æ¯›è¡£ + ç™½è‰²åŠè£™", "å¤§è¡£ + åŒè‰²ç³»å†…æ­", "è¥¿è£…å¥—è£… + è¿åŠ¨é‹", "è¿è¡£è£™ + é‡‘å±é…é¥°", "æ£‰éº»å¥—è£…"],
        "æ°´": ["æ¯›è¡£ + ç™½è‰²é˜”è…¿è£¤", "ä¸ç»’è£™ + æµ…è‰²å¤–å¥—", "è¡¬è¡« + å¡å…¶è‰²é•¿è£¤", "ç‰›ä»”å¥—è£… + ç™½Tæ¤", "é’ˆç»‡å¼€è¡« + ç¢èŠ±è£™", "é£è¡£ + ç±³è‰²å†…æ­", "ç¼é¢åŠè£™ + é’ˆç»‡è¡«"]
    };

    // ---------- é¡µé¢åˆ‡æ¢ ----------
    window.goToPage = function(pageNum) {
        // éšè—æ‰€æœ‰é¡µé¢
        for (let i = 3; i <= 11; i++) {
            const page = document.getElementById(`page${i}`);
            if (page) page.classList.remove('active');
        }
        // æ˜¾ç¤ºé€‰ä¸­é¡µé¢
        const targetPage = document.getElementById(`page${pageNum}`);
        if (targetPage) targetPage.classList.add('active');
        
        // æ›´æ–°å¯¼èˆªç‚¹
        updateNavDots(pageNum);
    };
    
    function updateNavDots(activePage) {
        document.querySelectorAll('.nav-dot').forEach((dot, index) => {
            const pageNum = index + 3;
            if (pageNum === activePage) {
                dot.classList.add('active');
            } else {
                dot.classList.remove('active');
            }
        });
    }

    // ---------- èŠ‚æ°”è¡¨ ----------
    function getSolarTermDate(year, term) {
        if (term === "lichun") {
            if (year === 1994) return [1, 4];
            if (year === 1998) return [1, 4];
            if (year === 2026) return [1, 4];
            return [1, 4];
        }
        if (term === "jingzhe") {
            if (year === 1994) return [2, 6];
            if (year === 1998) return [2, 6];
            if (year === 2026) return [2, 5];
            return [2, 5];
        }
        if (term === "qingming") {
            if (year === 1994) return [3, 5];
            if (year === 1998) return [3, 5];
            if (year === 2026) return [3, 5];
            return [3, 5];
        }
        if (term === "lixia") {
            if (year === 1994) return [4, 6];
            if (year === 1998) return [4, 6];
            if (year === 2026) return [4, 5];
            return [4, 5];
        }
        if (term === "mangzhong") {
            if (year === 1994) return [5, 6];
            if (year === 1998) return [5, 6];
            if (year === 2026) return [5, 5];
            return [5, 6];
        }
        if (term === "xiaoshu") return [6, 7];
        if (term === "liqiu") {
            if (year === 1994) return [7, 8];
            if (year === 1998) return [7, 8];
            return [7, 7];
        }
        if (term === "bailu") {
            if (year === 1994) return [8, 8];
            if (year === 1998) return [8, 8];
            return [8, 7];
        }
        if (term === "hanlu") {
            if (year === 1994) return [9, 9];
            if (year === 1998) return [9, 8];
            return [9, 8];
        }
        if (term === "lidong") {
            if (year === 1994) return [10, 7];
            if (year === 1998) return [10, 7];
            return [10, 7];
        }
        if (term === "daxue") {
            if (year === 1994) return [11, 7];
            if (year === 1998) return [11, 7];
            return [11, 7];
        }
        if (term === "xiaohan") {
            if (year === 1995) return [0, 6];
            if (year === 1999) return [0, 6];
            return [0, 5];
        }
        return [0, 1];
    }

    // ---------- æœˆæŸ± ----------
    function getMonthGanzhi(date) {
        const year = date.getFullYear();
        const month = date.getMonth();
        const day = date.getDate();
        
        const lichun = getSolarTermDate(year, "lichun");
        const jingzhe = getSolarTermDate(year, "jingzhe");
        const qingming = getSolarTermDate(year, "qingming");
        const lixia = getSolarTermDate(year, "lixia");
        const mangzhong = getSolarTermDate(year, "mangzhong");
        const xiaoshu = getSolarTermDate(year, "xiaoshu");
        const liqiu = getSolarTermDate(year, "liqiu");
        const bailu = getSolarTermDate(year, "bailu");
        const hanlu = getSolarTermDate(year, "hanlu");
        const lidong = getSolarTermDate(year, "lidong");
        const daxue = getSolarTermDate(year, "daxue");
        const nextYearXiaohan = getSolarTermDate(year + 1, "xiaohan");
        
        let monthIndex;
        let targetYear = year;
        
        if (month < lichun[0] || (month === lichun[0] && day < lichun[1])) {
            monthIndex = 11;
            targetYear = year - 1;
        }
        else if (month < jingzhe[0] || (month === jingzhe[0] && day < jingzhe[1])) {
            monthIndex = 0;
        }
        else if (month < qingming[0] || (month === qingming[0] && day < qingming[1])) {
            monthIndex = 1;
        }
        else if (month < lixia[0] || (month === lixia[0] && day < lixia[1])) {
            monthIndex = 2;
        }
        else if (month < mangzhong[0] || (month === mangzhong[0] && day < mangzhong[1])) {
            monthIndex = 3;
        }
        else if (month < xiaoshu[0] || (month === xiaoshu[0] && day < xiaoshu[1])) {
            monthIndex = 4;
        }
        else if (month < liqiu[0] || (month === liqiu[0] && day < liqiu[1])) {
            monthIndex = 5;
        }
        else if (month < bailu[0] || (month === bailu[0] && day < bailu[1])) {
            monthIndex = 6;
        }
        else if (month < hanlu[0] || (month === hanlu[0] && day < hanlu[1])) {
            monthIndex = 7;
        }
        else if (month < lidong[0] || (month === lidong[0] && day < lidong[1])) {
            monthIndex = 8;
        }
        else if (month < daxue[0] || (month === daxue[0] && day < daxue[1])) {
            monthIndex = 9;
        }
        else {
            monthIndex = 10;
            if (month === 0 && day < nextYearXiaohan[1]) {
                targetYear = year - 1;
            }
        }
        
        let yearGan;
        if (targetYear === 1994) yearGan = "ç”²";
        else if (targetYear === 1998) yearGan = "æˆŠ";
        else if (targetYear === 2026) yearGan = "ä¸™";
        else {
            const baseYear = 1984;
            let diff = targetYear - baseYear;
            let ganIndex = diff % 10;
            if (ganIndex < 0) ganIndex += 10;
            yearGan = TIAN_GAN[ganIndex];
        }
        
        let firstMonthGan;
        if (yearGan === "ç”²" || yearGan === "å·±") firstMonthGan = "ä¸™";
        else if (yearGan === "ä¹™" || yearGan === "åºš") firstMonthGan = "æˆŠ";
        else if (yearGan === "ä¸™" || yearGan === "è¾›") firstMonthGan = "åºš";
        else if (yearGan === "ä¸" || yearGan === "å£¬") firstMonthGan = "å£¬";
        else if (yearGan === "æˆŠ" || yearGan === "ç™¸") firstMonthGan = "ç”²";
        
        const firstGanIndex = TIAN_GAN.indexOf(firstMonthGan);
        let ganIndex = (firstGanIndex + monthIndex) % 10;
        ganIndex = (ganIndex + 10) % 10;
        
        return { gan: TIAN_GAN[ganIndex], zhi: DI_ZHI_MONTH[monthIndex] };
    }

    // ---------- æ—¥æŸ± ----------
    function getDayGanzhi(date) {
        const base = new Date(Date.UTC(2000, 0, 1));
        const target = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
        const diff = Math.round((target - base) / (86400000));
        let gan = (4 + diff) % 10;
        let zhi = (6 + diff) % 12;
        gan = (gan + 10) % 10;
        zhi = (zhi + 12) % 12;
        return { gan: TIAN_GAN[gan], zhi: DI_ZHI_OTHER[zhi] };
    }

    // ---------- å¹´æŸ± ----------
    function getYearGanzhi(date) {
        const year = date.getFullYear();
        const month = date.getMonth() + 1;
        const lichun = getSolarTermDate(year, "lichun");
        let targetYear = year;
        
        if (month < lichun[0] + 1 || (month === lichun[0] + 1 && date.getDate() < lichun[1])) {
            targetYear = year - 1;
        }
        
        if (targetYear === 1994) return { gan: "ç”²", zhi: "æˆŒ" };
        if (targetYear === 1998) return { gan: "æˆŠ", zhi: "å¯…" };
        if (targetYear === 2026) return { gan: "ä¸™", zhi: "åˆ" };
        
        const baseYear = 1984;
        let diff = targetYear - baseYear;
        let ganIndex = diff % 10;
        let zhiIndex = diff % 12;
        if (ganIndex < 0) ganIndex += 10;
        if (zhiIndex < 0) zhiIndex += 12;
        
        return { gan: TIAN_GAN[ganIndex], zhi: DI_ZHI_OTHER[zhiIndex] };
    }

    // ---------- å–œç”¨åˆ¤æ–­ ----------
    function getXiYong(gan, month) {
        let set = [];
        if (month >= 3 && month <= 5) {
            if (gan === "ç”²" || gan === "ä¹™") set = ["æœ¨","ç«"];
            else if (gan === "ä¸™" || gan === "ä¸") set = ["æœ¨","ç«"];
            else if (gan === "æˆŠ" || gan === "å·±") set = ["ç«","åœŸ"];
            else if (gan === "åºš" || gan === "è¾›") set = ["åœŸ","é‡‘"];
            else if (gan === "å£¬" || gan === "ç™¸") set = ["é‡‘","æ°´"];
        } else if (month >= 6 && month <= 8) {
            if (gan === "ç”²" || gan === "ä¹™") set = ["æ°´","æœ¨"];
            else if (gan === "ä¸™" || gan === "ä¸") set = ["æ°´"];
            else if (gan === "æˆŠ" || gan === "å·±") set = ["æ°´","é‡‘"];
            else if (gan === "åºš" || gan === "è¾›") set = ["æ°´","åœŸ"];
            else if (gan === "å£¬" || gan === "ç™¸") set = ["é‡‘","æ°´"];
        } else if (month >= 9 && month <= 11) {
            if (gan === "ç”²" || gan === "ä¹™") set = ["æ°´","æœ¨"];
            else if (gan === "ä¸™" || gan === "ä¸") set = ["æœ¨","ç«"];
            else if (gan === "æˆŠ" || gan === "å·±") set = ["ç«","åœŸ"];
            else if (gan === "åºš" || gan === "è¾›") set = ["åœŸ","é‡‘"];
            else if (gan === "å£¬" || gan === "ç™¸") set = ["é‡‘","æ°´"];
        } else {
            if (gan === "ç”²" || gan === "ä¹™") set = ["ç«","åœŸ"];
            else if (gan === "ä¸™" || gan === "ä¸") set = ["æœ¨","ç«"];
            else if (gan === "æˆŠ" || gan === "å·±") set = ["ç«","åœŸ"];
            else if (gan === "åºš" || gan === "è¾›") set = ["ç«","åœŸ"];
            else if (gan === "å£¬" || gan === "ç™¸") set = ["ç«","åœŸ"];
        }
        return [...new Set(set)];
    }

    // ---------- å¿Œç”¨æ¨å¯¼ ----------
    function getJiYong(xiSet) {
        const KE_MAP = {"æœ¨":"åœŸ","ç«":"é‡‘","åœŸ":"æ°´","é‡‘":"æœ¨","æ°´":"ç«"};
        const BEI_KE_MAP = {"æœ¨":"é‡‘","ç«":"æ°´","åœŸ":"æœ¨","é‡‘":"ç«","æ°´":"åœŸ"};
        let jiSet = new Set();
        xiSet.forEach(w => {
            if (BEI_KE_MAP[w]) jiSet.add(BEI_KE_MAP[w]);
            if (KE_MAP[w]) jiSet.add(KE_MAP[w]);
        });
        xiSet.forEach(w => jiSet.delete(w));
        return [...jiSet];
    }

    // ---------- æ¯æ—¥é¢œè‰² + å…³ç³» + å…¬å¼ ----------
    function dailyColors(dayGan, xiSet) {
        const mainXi = xiSet[0];
        const dayWu = GAN_WUXING[dayGan];
        if (!dayWu) return { 
            primary: mainXi, 
            secondary: xiSet[1] || (mainXi==="æœ¨"?"ç«":"åœŸ"), 
            relation: "å¹³", 
            desc: "ä»Šæ—¥æ°”åœºå¹³å’Œ",
            formula: "",
            type: "å¹³"
        };

        const isGenerate = (a,b) => 
            (a==="æœ¨"&&b==="ç«")||(a==="ç«"&&b==="åœŸ")||(a==="åœŸ"&&b==="é‡‘")||(a==="é‡‘"&&b==="æ°´")||(a==="æ°´"&&b==="æœ¨");
        const isRestrain = (a,b) => 
            (a==="æœ¨"&&b==="åœŸ")||(a==="åœŸ"&&b==="æ°´")||(a==="æ°´"&&b==="ç«")||(a==="ç«"&&b==="é‡‘")||(a==="é‡‘"&&b==="æœ¨");

        let pri = mainXi, sec = xiSet[1] || (mainXi==="æœ¨"?"ç«":"åœŸ");
        let relation = "";
        let desc = "";
        let formula = "";
        let type = "";

        if (dayWu === mainXi) {
            pri = mainXi;
            sec = xiSet[1] || (mainXi==="æœ¨"?"ç«":(mainXi==="ç«"?"åœŸ":(mainXi==="åœŸ"?"é‡‘":(mainXi==="é‡‘"?"æ°´":"æœ¨"))));
            relation = "æ¯”å’Œç›¸åŠ©";
            type = "æ°”åœºå…±é¸£";
            desc = `ä»Šæ—¥å¤©å¹²ä¸º${dayGan}ï¼Œäº”è¡Œå±${dayWu}ï¼Œä¸æ‚¨çš„å–œç”¨äº”è¡Œ${mainXi}ç›¸åŒï¼Œæ°”åœºèƒ½é‡é›†ä¸­ï¼Œé€‚åˆå±•ç°è‡ªæˆ‘ç‰¹è´¨ã€‚`;
            formula = `ç©¿æ­å…¬å¼ = ${WUXING_COLOR_NAME[pri]}ä¸ºä¸»è‰²(70%) + ${WUXING_COLOR_NAME[sec]}ä¸ºè¾…è‰²(30%)ï¼ŒåŠ å…¥åŒè‰²ç³»é‚»è¿‘è‰²åšå±‚æ¬¡ã€‚`;
        }
        else if (isGenerate(dayWu, mainXi)) {
            pri = mainXi;
            sec = dayWu;
            relation = `${dayWu}ç”Ÿ${mainXi}`;
            type = "å¤©æ—¶åŠ©è¿Â·ç”Ÿå±€";
            desc = `ä»Šæ—¥å¤©å¹²ä¸º${dayGan}ï¼Œäº”è¡Œå±${dayWu}ï¼Œç”ŸåŠ©æ‚¨çš„å–œç”¨äº”è¡Œ${mainXi}ï¼Œæ˜¯ã€Œå¤§å‰æ°”åœºæ—¥ã€ï¼Œæ— éœ€åˆ»æ„å¼±åŒ–ï¼Œæ”¾å¤§å–œç”¨è‰²çš„å­˜åœ¨æ„Ÿå³å¯ã€‚`;
            formula = `ç©¿æ­å…¬å¼ = ${WUXING_COLOR_NAME[pri]}ä¸ºä¸»è‰²(70%) + ${WUXING_COLOR_NAME[sec]}ä¸ºè¾…è‰²(30%)ï¼Œæ­é…å¯¹åº”äº”è¡Œé¥°å“å¢å¼ºæ°”åœºã€‚`;
        }
        else if (isGenerate(mainXi, dayWu)) {
            if (mainXi === "æœ¨") pri = "æ°´";
            else if (mainXi === "ç«") pri = "æœ¨";
            else if (mainXi === "åœŸ") pri = "ç«";
            else if (mainXi === "é‡‘") pri = "åœŸ";
            else if (mainXi === "æ°´") pri = "é‡‘";
            sec = mainXi;
            relation = `${mainXi}ç”Ÿ${dayWu}`;
            type = "èƒ½é‡å¤–æ³„Â·è¡¥æº";
            desc = `ä»Šæ—¥å¤©å¹²ä¸º${dayGan}ï¼Œäº”è¡Œå±${dayWu}ï¼Œæ‚¨çš„å–œç”¨äº”è¡Œ${mainXi}ç”ŸåŠ©å½“æ—¥å¤©å¹²ï¼Œèƒ½é‡å¤–æ³„ï¼Œéœ€è¡¥å……ç”ŸåŠ©å–œç”¨çš„æºå¤´ä¹‹è‰²ã€‚`;
            formula = `ç©¿æ­å…¬å¼ = ${WUXING_COLOR_NAME[pri]}ä¸ºä¸»è‰²(60%) + ${WUXING_COLOR_NAME[sec]}ä¸ºè¾…è‰²(40%)ï¼Œä»¥æºå¤´ä¹‹è‰²æ»‹å…»æœ¬å‘½æ°”åœºã€‚`;
        }
        else if (isRestrain(dayWu, mainXi)) {
            if (dayWu === "æœ¨" && mainXi === "åœŸ") pri = "ç«";
            else if (dayWu === "åœŸ" && mainXi === "æ°´") pri = "é‡‘";
            else if (dayWu === "æ°´" && mainXi === "ç«") pri = "æœ¨";
            else if (dayWu === "ç«" && mainXi === "é‡‘") pri = "åœŸ";
            else if (dayWu === "é‡‘" && mainXi === "æœ¨") pri = "æ°´";
            sec = mainXi;
            relation = `${dayWu}å…‹${mainXi}`;
            type = "å¤©æ—¶åˆ¶è¡¡Â·å…‹å±€";
            desc = `ä»Šæ—¥å¤©å¹²ä¸º${dayGan}ï¼Œäº”è¡Œå±${dayWu}ï¼Œå…‹åˆ¶æ‚¨çš„å–œç”¨äº”è¡Œ${mainXi}ï¼Œéœ€ç”¨é€šå…³äº”è¡Œè°ƒå’Œï¼Œå¼±åŒ–å†²çªï¼Œç¨³ä¸­æ±‚é¡ºã€‚`;
            formula = `ç©¿æ­å…¬å¼ = ${WUXING_COLOR_NAME[pri]}é€šå…³è‰²(50%) + ${WUXING_COLOR_NAME[sec]}åŸºç¡€è‰²(40%) + ä¸­æ€§è‰²(10%)ï¼Œç”¨é€šå…³è‰²åŒ–è§£å…‹åˆ¶ã€‚`;
        }
        else if (isRestrain(mainXi, dayWu)) {
            pri = mainXi;
            sec = xiSet[1] || (mainXi==="æœ¨"?"ç«":"åœŸ");
            relation = `${mainXi}å…‹${dayWu}`;
            type = "å–œç”¨å¾—åŠ¿";
            desc = `ä»Šæ—¥å¤©å¹²ä¸º${dayGan}ï¼Œäº”è¡Œå±${dayWu}ï¼Œè¢«æ‚¨çš„å–œç”¨äº”è¡Œ${mainXi}å…‹åˆ¶ï¼Œå–œç”¨å¾—åŠ¿ï¼Œå¯å¤§èƒ†ä½¿ç”¨å–œç”¨è‰²ã€‚`;
            formula = `ç©¿æ­å…¬å¼ = ${WUXING_COLOR_NAME[pri]}ä¸ºä¸»è‰²(70%) + ${WUXING_COLOR_NAME[sec]}ä¸ºè¾…è‰²(30%)ï¼Œæ°”åœºå…¨å¼€ã€‚`;
        }
        return { primary: pri, secondary: sec, relation, desc, formula, type };
    }

    // ---------- è·å–é…é¥° ----------
    function getAccessory(primary, dayIndex) {
        const lib = ACCESSORY_LIBRARY[primary] || ACCESSORY_LIBRARY["åœŸ"];
        return lib[dayIndex % lib.length];
    }

    // ---------- è·å–ç©¿æ­å•å“ ----------
    function getOutfit(primary, dayIndex, style) {
        const lib = OUTFIT_LIBRARY[primary] || OUTFIT_LIBRARY["åœŸ"];
        return lib[dayIndex % lib.length];
    }

    // ---------- ä»URLæˆ–å…¨å±€å˜é‡è·å–å‚æ•° ----------
    function getParameters() {
        // å°è¯•ä»å…¨å±€å˜é‡è·å–ï¼ˆç”±åç«¯æ³¨å…¥ï¼‰
        if (typeof BIRTH_DATE !== 'undefined' && typeof START_DATE !== 'undefined' && typeof STYLE_PREF !== 'undefined') {
            return {
                birth: BIRTH_DATE,
                start: START_DATE,
                style: STYLE_PREF
            };
        }
        
        // å¦‚æœå…¨å±€å˜é‡ä¸å­˜åœ¨ï¼Œå°è¯•ä»URLå‚æ•°è·å–
        const urlParams = new URLSearchParams(window.location.search);
        return {
            birth: urlParams.get('birth') || '1994-12-15',
            start: urlParams.get('start') || '',
            style: urlParams.get('style') || 'neutral'
        };
    }

    // ---------- ç”ŸæˆæŠ¥å‘Š ----------
    function generateReport() {
        const params = getParameters();
        const birthDate = new Date(params.birth + 'T12:00:00');
        const startDate = new Date(params.start + 'T12:00:00');
        const style = params.style;
        
        // å››æŸ±è®¡ç®—
        const yearGz = getYearGanzhi(birthDate);
        const monthGz = getMonthGanzhi(birthDate);
        const dayGz = getDayGanzhi(birthDate);
        
        const monthNum = birthDate.getMonth() + 1;
        const xiSet = getXiYong(dayGz.gan, monthNum);
        const jiSet = getJiYong(xiSet);
        const mainXi = xiSet[0];
        
        // å¡«å……å‡ºç”Ÿæ—¥æœŸ
        const birthYear = birthDate.getFullYear();
        const birthMonth = (birthDate.getMonth() + 1).toString().padStart(2, '0');
        const birthDay = birthDate.getDate().toString().padStart(2, '0');
        document.getElementById('birthFullDate').innerText = `${birthYear}.${birthMonth}.${birthDay}`;
        
        // å››æŸ±æ˜¾ç¤º
        document.getElementById('sizhuDisplay').innerHTML = `
            <div class="zhu-item"><span class="zhu-label">å¹´æŸ±</span><span class="zhu-value">${yearGz.gan}${yearGz.zhi}</span></div>
            <div class="zhu-item"><span class="zhu-label">æœˆæŸ±</span><span class="zhu-value">${monthGz.gan}${monthGz.zhi}</span></div>
            <div class="zhu-item"><span class="zhu-label">æ—¥æŸ±</span><span class="zhu-value">${dayGz.gan}${dayGz.zhi}</span></div>
        `;
        
        // å–œç”¨æ˜¾ç¤º
        const xiChips = xiSet.map(w => {
            return `<span class="wuxing-badge"><span class="color-chip" data-wuxing="${w}"></span>${WUXING_COLOR_NAME[w]}</span>`;
        }).join('');
        document.getElementById('xiDisplay').innerHTML = xiChips;
        document.getElementById('xiDesc').innerHTML = XI_DESC[mainXi] || XI_DESC["åœŸ"];
        
        // å¿Œç”¨æ˜¾ç¤º
        const jiChips = jiSet.length ? jiSet.map(w => {
            return `<span class="wuxing-badge"><span class="color-chip" data-wuxing="${w}"></span>${WUXING_COLOR_NAME[w]}</span>`;
        }).join('') : '<span class="wuxing-badge">æ— ç‰¹æ®Šå¿Œç”¨</span>';
        document.getElementById('jiDisplay').innerHTML = jiChips;
        
        // é©¬å¹´å¼€è¿åŸºè°ƒ
        document.getElementById('yearBase').innerHTML = `2026ä¸™åˆé©¬å¹´ï¼Œæ‚¨çš„å¼€è¿åŸºè°ƒä»¥${WUXING_COLOR_NAME[mainXi]}ç³»ä¸ºä¸»ï¼Œ${XI_DESC[mainXi].split('ã€‚')[0]}ã€‚`;
        
        // ç”Ÿæˆä¸€å‘¨æ—¥æœŸ
        const weekDays = [];
        for (let i = 0; i < 7; i++) {
            let d = new Date(startDate);
            d.setDate(startDate.getDate() + i);
            weekDays.push(d);
        }
        
        const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
        
        // æ›´æ–°ä¸€å‘¨æ¦‚è§ˆé¡µ
        const startYear = weekDays[0].getFullYear();
        const startMonth = (weekDays[0].getMonth() + 1).toString().padStart(2, '0');
        const startDay = weekDays[0].getDate().toString().padStart(2, '0');
        const endYear = weekDays[6].getFullYear();
        const endMonth = (weekDays[6].getMonth() + 1).toString().padStart(2, '0');
        const endDay = weekDays[6].getDate().toString().padStart(2, '0');
        document.getElementById('weekDates').innerHTML = `${startYear}.${startMonth}.${startDay} â€” ${endYear}.${endMonth}.${endDay}`;
        
        let circlesHtml = '';
        weekDays.forEach((day, idx) => {
            const month = (day.getMonth() + 1).toString().padStart(2, '0');
            const d = day.getDate().toString().padStart(2, '0');
            circlesHtml += `
                <div class="day-circle" onclick="goToPage(${idx + 5})">
                    <span>${idx + 1}</span>
                    ${month}/${d}
                </div>
            `;
        });
        document.getElementById('dayCircles').innerHTML = circlesHtml;
        
        // å¡«å……æ¯æ—¥é¡µé¢
        weekDays.forEach((day, idx) => {
            const pageNum = idx + 5;
            const gz = getDayGanzhi(day);
            const gan = gz.gan;
            const daily = dailyColors(gan, xiSet);
            const pri = daily.primary;
            const sec = daily.secondary;
            
            const year = day.getFullYear();
            const month = (day.getMonth() + 1).toString().padStart(2, '0');
            const d = day.getDate().toString().padStart(2, '0');
            const weekday = weekdays[day.getDay()];
            const dateStr = `${year}.${month}.${d} ${weekday}`;
            
            const fitColorStr = WUXING_COLOR_NAME[pri] + (pri !== sec ? 'ã€' + WUXING_COLOR_NAME[sec] : '');
            
            let avoidStr = '';
            const todayAvoid = jiSet.filter(w => w !== pri && w !== sec);
            if (todayAvoid.length) {
                avoidStr = `æ…ç”¨ ${todayAvoid.map(w => WUXING_COLOR_NAME[w]).join('ã€')}`;
            }
            
            const accessory = getAccessory(pri, idx);
            const outfit = getOutfit(pri, idx, style);
            
            const prevBtn = idx > 0 ? `<button class="page-btn" onclick="goToPage(${idx + 4})">â† å‰ä¸€å¤©</button>` : `<button class="page-btn" disabled>â† å‰ä¸€å¤©</button>`;
            const nextBtn = idx < 6 ? `<button class="page-btn primary" onclick="goToPage(${idx + 6})">åä¸€å¤© â†’</button>` : `<button class="page-btn" disabled>åä¸€å¤© â†’</button>`;
            
            const pageHtml = `
                <div class="header">
                    <div class="title">ç¬¬ ${idx + 1} å¤©</div>
                    <div class="subtitle">${dateStr}</div>
                </div>
                
                <div class="daily-card">
                    <div class="card-header">
                        <div class="date-section">
                            <span class="date-badge">${gz.gan}${gz.zhi}</span>
                            <span class="weekday-badge">${daily.type}</span>
                        </div>
                        <div class="ganzhi-section">
                            <div class="ganzhi-badge">æ—¥æŸ±</div>
                            <div class="relation-badge">${gz.gan}${gz.zhi}</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="color-section">
                            <div class="color-dots">
                                <span class="color-dot-large" data-wuxing="${pri}"></span>
                                <span class="color-dot-large" data-wuxing="${sec}"></span>
                            </div>
                            <span class="color-names">${fitColorStr}</span>
                            ${avoidStr ? `<span class="avoid-tag">${avoidStr}</span>` : ''}
                        </div>
                        
                        <div class="formula-section">
                            <div class="formula-title">ç©¿æ­å…¬å¼</div>
                            <div class="formula-text">${daily.formula}</div>
                        </div>
                        
                        <div class="analysis-section">
                            <div class="analysis-title">ç„å­¦è§£æ</div>
                            <div class="analysis-text">${daily.desc}</div>
                        </div>
                        
                        <div class="outfit-section">
                            <div class="outfit-title">å•å“æ¨è</div>
                            <div class="outfit-text">${outfit}</div>
                        </div>
                        
                        <div class="accessory-section">
                            <div class="accessory-title">å¼€è¿é…é¥°</div>
                            <div class="accessory-text">${accessory}</div>
                        </div>
                    </div>
                </div>
                
                <div class="page-buttons">
                    ${prevBtn}
                    <button class="page-btn" onclick="goToPage(4)">ä¸€å‘¨æ¦‚è§ˆ</button>
                    ${nextBtn}
                </div>
                
                <div class="nav-dots">
                    <button class="nav-dot" onclick="goToPage(3)"></button>
                    <button class="nav-dot" onclick="goToPage(4)"></button>
                    <button class="nav-dot" onclick="goToPage(5)"></button>
                    <button class="nav-dot" onclick="goToPage(6)"></button>
                    <button class="nav-dot" onclick="goToPage(7)"></button>
                    <button class="nav-dot" onclick="goToPage(8)"></button>
                    <button class="nav-dot" onclick="goToPage(9)"></button>
                    <button class="nav-dot" onclick="goToPage(10)"></button>
                    <button class="nav-dot" onclick="goToPage(11)"></button>
                </div>
            `;
            
            document.getElementById(`page${pageNum}`).innerHTML = pageHtml;
        });
        
        // é»˜è®¤æ˜¾ç¤ºç¬¬3é¡µ
        goToPage(3);
    }

    // ---------- åˆå§‹åŒ– ----------
    window.onload = function() {
        generateReport();
    };
</script>
</body>
</html>